@model ComputerStore.Models.Supply

@{ ViewData["Title"] = "Поставка №" + Model.Id; }

<h1>Поставка №@Model.Id</h1>

<div>
    <hr />
    <dl class="row">
        <dt class="col-sm-2">Поставщик</dt>
        <dd class="col-sm-10">@Model.Supplier.Name</dd>
        <dt class="col-sm-2">Дата</dt>
        <dd class="col-sm-10">@Model.Date</dd>
        <dt class="col-sm-2">Итого сумма</dt>
        <dd class="col-sm-10"><h3>@Model.TotalAmount.ToString("C")</h3></dd>
    </dl>
</div>

<hr />

<div class="card bg-light mb-3">
    <div class="card-header">Добавить товар в поставку</div>
    <div class="card-body">
        <form asp-action="AddLineItem" method="post" class="row g-3">
            <input type="hidden" name="supplyId" value="@Model.Id" />
            
            <div class="col-md-5">
                <label class="form-label">Товар (Поиск по Коду/Имени)</label>
                <select name="productId" class="form-control select2-search" asp-items="ViewBag.ProductId"></select>
            </div>
            <div class="col-md-3">
                <label class="form-label">Количество</label>
                <input type="number" name="quantity" class="form-control" value="1" min="1" required />
            </div>
            <div class="col-md-2">
                <label class="form-label">Цена закупки</label>
                <input type="number" name="purchasePrice" class="form-control" value="0" min="0" step="0.01" required />
            </div>
            <div class="col-md-2 d-flex align-items-end">
                <button type="submit" class="btn btn-success w-100">+ Добавить</button>
            </div>
        </form>
    </div>
</div>

<h4>Состав поставки</h4>
<table class="table table-striped">
    <thead>
        <tr>
            <th>Товар</th>
            <th>Кол-во</th>
            <th>Цена закупки</th>
            <th>Сумма</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model.SupplyItems)
        {
            <tr>
                <td>@item.Product.Name</td>
                <td>@item.Quantity</td>
                <td>@item.PurchasePrice.ToString("C")</td>
                <td>@((item.Quantity * item.PurchasePrice).ToString("C"))</td>
            </tr>
        }
    </tbody>
</table>

<div class="mt-3">
    <a asp-action="Index" class="btn btn-primary">Завершить и вернуться в журнал</a>
</div>